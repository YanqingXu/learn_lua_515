# 如何运行 Continue 关键字测试

## 🚀 快速开始（推荐）

### Windows PowerShell

```powershell
cd tests
.\run_tests.ps1
```

### 命令行（所有系统）

```bash
cd tests
lua quick_test.lua
```

这将运行快速验证测试（10个测试，~5秒），验证 continue 关键字是否正常工作。

## 📋 测试选项

### 1️⃣ 快速验证测试（推荐新手）

**用途**: 快速验证 continue 是否正常工作  
**时间**: ~5秒  
**测试数**: 10个

```bash
lua quick_test.lua
```

**预期输出**:
```
======================================================================
Continue 关键字 - 快速验证测试
======================================================================

For 循环基本功能 ... ✓ 通过
While 循环 ... ✓ 通过
...
✓✓✓ 所有快速测试通过！Continue 关键字工作正常！
```

### 2️⃣ 基础功能测试

**用途**: 测试所有循环类型的基本功能  
**时间**: ~1秒  
**测试数**: 22个

```bash
lua test_continue_basic.lua
```

### 3️⃣ 高级功能测试

**用途**: 测试复杂场景和实际应用  
**时间**: ~2秒  
**测试数**: 22个

```bash
lua test_continue_advanced.lua
```

### 4️⃣ 错误处理测试

**用途**: 测试错误检测和边界条件  
**时间**: ~1秒  
**测试数**: 22个

```bash
lua test_continue_errors.lua
```

### 5️⃣ 性能测试

**用途**: 测试性能和大规模场景  
**时间**: ~30-60秒  
**测试数**: 16个

```bash
lua test_continue_performance.lua
```

### 6️⃣ 完整测试套件

**用途**: 运行所有测试（除性能测试外）  
**时间**: ~5-10秒  
**测试数**: 66个

```bash
lua run_all_tests.lua
```

## 🔧 使用编译后的 Lua

如果您已经编译了带有 continue 关键字的 Lua，应该使用编译后的可执行文件：

### Windows

```cmd
cd tests

REM 如果在 bin 目录
..\bin\lua.exe quick_test.lua

REM 如果在构建目录
..\lua\x64\Debug\lua.exe quick_test.lua
```

### Linux/Unix

```bash
cd tests

# 如果在 bin 目录
../bin/lua quick_test.lua

# 如果在构建目录
../lua quick_test.lua
```

## 📊 交互式运行（PowerShell）

使用 PowerShell 脚本可以交互式选择测试：

```powershell
cd tests
.\run_tests.ps1
```

然后按提示选择：
```
选择测试模式：
  1. 快速验证测试 (10个测试, ~5秒)
  2. 基础功能测试 (22个测试, ~1秒)
  3. 高级功能测试 (22个测试, ~2秒)
  4. 错误处理测试 (22个测试, ~1秒)
  5. 性能测试 (16个测试, ~30-60秒)
  6. 完整测试套件 (所有测试)

请选择 (1-6): _
```

## ✅ 测试成功示例

### 快速验证测试成功

```
======================================================================
Continue 关键字 - 快速验证测试
======================================================================

运行快速验证测试...

For 循环基本功能 ... ✓ 通过
While 循环 ... ✓ 通过
Repeat-Until 循环 ... ✓ 通过
嵌套循环 ... ✓ 通过
Continue 与 ipairs ... ✓ 通过
错误检测 (循环外) ... ✓ 通过
Continue 前后代码执行 ... ✓ 通过
多条件 Continue ... ✓ 通过
Continue 与函数 ... ✓ 通过
Continue 与局部变量 ... ✓ 通过

======================================================================
✓✓✓ 所有快速测试通过！Continue 关键字工作正常！
======================================================================
```

### 完整测试套件成功

```
======================================================================
Continue 关键字 - 完整测试套件
======================================================================

----------------------------------------------------------------------
运行: 基础功能测试
----------------------------------------------------------------------
✓ TEST 1 PASSED: For循环跳过偶数
✓ TEST 2 PASSED: For循环跳过特定值(3)
...
✓ 所有基础测试通过！

----------------------------------------------------------------------
运行: 高级功能测试
----------------------------------------------------------------------
...
✓ 所有高级测试通过！

----------------------------------------------------------------------
运行: 错误处理测试
----------------------------------------------------------------------
...
✓ 所有错误处理测试通过！

======================================================================
测试报告
======================================================================

1. 基础功能测试: ✓ 通过
2. 高级功能测试: ✓ 通过
3. 错误处理测试: ✓ 通过

----------------------------------------------------------------------
总计:       3 个测试套件
通过:       3
失败:       0
耗时:       4.23 秒
----------------------------------------------------------------------

✓ 所有测试套件通过！Continue 关键字实现正确！
```

## ❌ 测试失败诊断

### 编译错误

**症状**: 
```
lua: test.lua:3: unexpected symbol near 'continue'
```

**原因**: continue 关键字未添加到 Lua

**解决方案**:
1. 确保您使用的是编译了 continue 支持的 Lua
2. 检查 `lua/src/llex.h` 和 `lua/src/llex.c`
3. 重新编译 Lua

### 功能错误

**症状**:
```
✗ TEST 1 FAILED: For循环跳过偶数
  Expected: 1,3,5,7,9
  Got:      1,2,3,4,5,6,7,8,9,10
```

**原因**: continue 实现不正确

**解决方案**:
1. 检查 `lua/src/lparser.c` 中的修改
2. 参考 `../modify/continue/CONTINUE_KEYWORD_IMPLEMENTATION.md`
3. 运行 `lua test_continue_errors.lua` 查看错误检测是否正常

### 错误检测失败

**症状**:
```
✗ TEST FAILED: 错误检测 (循环外)
  Expected error but code executed successfully
```

**原因**: 缺少错误检查

**解决方案**:
1. 检查 continuestat() 函数
2. 确保 "no loop to continue" 错误正确触发

## 🎯 推荐测试流程

### 第一次测试

```bash
# 1. 快速验证
cd tests
lua quick_test.lua

# 2. 如果通过，运行完整测试
lua run_all_tests.lua

# 3. 如果全部通过，运行性能测试（可选）
lua test_continue_performance.lua
```

### 开发过程中

```bash
# 修改代码后，快速验证
lua quick_test.lua

# 如果修改了特定功能，运行相关测试
lua test_continue_basic.lua      # 基本功能
lua test_continue_advanced.lua   # 高级功能
lua test_continue_errors.lua     # 错误处理
```

### 发布前

```bash
# 运行所有测试
lua run_all_tests.lua

# 运行性能测试
lua test_continue_performance.lua

# 确保全部通过
```

## 📚 更多信息

- **测试详情**: 查看 `TEST_SUMMARY.md`
- **测试说明**: 查看 `README.md`
- **Continue 使用**: 查看 `../modify/continue/USAGE_GUIDE.md`
- **实现详情**: 查看 `../modify/continue/CONTINUE_KEYWORD_IMPLEMENTATION.md`

## 💡 常见问题

### Q: 哪个测试应该先运行？
**A**: `quick_test.lua` - 它只需要 5 秒，可以快速验证基本功能。

### Q: 如果快速测试失败了怎么办？
**A**: 运行 `test_continue_errors.lua` 检查错误检测是否正常，然后检查编译和实现。

### Q: 性能测试需要运行吗？
**A**: 不是必须的。性能测试主要用于验证大规模场景，如果功能测试通过，说明实现是正确的。

### Q: 如何只测试特定功能？
**A**: 直接编辑测试文件，注释掉不需要的测试，或者创建自己的测试脚本。

### Q: 测试失败后如何调试？
**A**: 
1. 查看失败的测试名称和错误信息
2. 在测试文件中找到对应的测试代码
3. 单独运行该测试用例
4. 使用 print 调试或 Lua 调试器

## 🔗 相关命令

```bash
# 查看测试文件
ls tests/

# 进入测试目录
cd tests/

# 查看测试说明
cat README.md

# 查看测试总结
cat TEST_SUMMARY.md

# 查看帮助
cat HOW_TO_RUN.md
```

---

**最后更新**: 2024  
**版本**: 1.0  
**状态**: ✅ 就绪